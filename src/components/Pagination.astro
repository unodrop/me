---
/**
 * Pagination Component
 * 
 * Displays pagination controls for navigating through paginated content lists.
 * Intelligently shows page numbers with ellipsis for large page counts, keeping
 * the UI clean while providing quick access to first, last, and nearby pages.
 * 
 * Features:
 * - Smart page number display with ellipsis
 * - Previous/Next navigation buttons
 * - Active page highlighting
 * - Disabled state for unavailable navigation
 * - Responsive layout (stacks on mobile)
 * - Accessible with ARIA labels
 * 
 * @component
 * 
 * @example
 * ```astro
 * <Pagination 
 *   currentPage={3}
 *   totalPages={10}
 *   baseUrl="/writing"
 * />
 * ```
 */

interface Props {
  /** Current active page number (1-indexed) */
  currentPage: number;
  
  /** Total number of pages available */
  totalPages: number;
  
  /** Base URL for pagination links (e.g., "/writing") */
  baseUrl: string;
}

const { currentPage, totalPages, baseUrl } = Astro.props;

/**
 * Generates an array of page numbers to display with ellipsis
 * 
 * Uses smart logic to show relevant pages while keeping the UI compact:
 * - Shows all pages if 7 or fewer total pages
 * - Shows first, last, current, and nearby pages with ellipsis for gaps
 * - Example outputs:
 *   - [1, 2, 3, 4, "...", 20] (when on page 2 of 20)
 *   - [1, "...", 9, 10, 11, "...", 20] (when on page 10 of 20)
 *   - [1, "...", 17, 18, 19, 20] (when on page 19 of 20)
 * 
 * @param current - Current page number
 * @param total - Total number of pages
 * @returns Array of page numbers and ellipsis strings
 */
function getPageNumbers(current: number, total: number): (number | string)[] {
  if (total <= 7) {
    return Array.from({ length: total }, (_, i) => i + 1);
  }
  
  const pages: (number | string)[] = [];
  
  if (current <= 3) {
    pages.push(1, 2, 3, 4, '...', total);
  } else if (current >= total - 2) {
    pages.push(1, '...', total - 3, total - 2, total - 1, total);
  } else {
    pages.push(1, '...', current - 1, current, current + 1, '...', total);
  }
  
  return pages;
}

const pageNumbers = getPageNumbers(currentPage, totalPages);

/**
 * Generates the URL for a specific page number
 * 
 * Page 1 uses the base URL without a page number suffix.
 * Other pages append the page number (e.g., "/writing/2").
 * 
 * @param page - Page number to generate URL for
 * @returns Full URL path for the page
 */
function getPageUrl(page: number): string {
  return page === 1 ? baseUrl : `${baseUrl}/${page}`;
}
---

{totalPages > 1 && (
  <nav class="pagination" aria-label="Pagination">
    {currentPage > 1 ? (
      <a href={getPageUrl(currentPage - 1)} class="pagination-btn pagination-prev" aria-label="Previous page">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        <span>Previous</span>
      </a>
    ) : (
      <span class="pagination-btn pagination-prev disabled" aria-disabled="true">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        <span>Previous</span>
      </span>
    )}

    <div class="pagination-numbers">
      {pageNumbers.map((page) => (
        page === '...' ? (
          <span class="pagination-ellipsis">...</span>
        ) : (
          <a 
            href={getPageUrl(page as number)} 
            class={`pagination-number ${page === currentPage ? 'active' : ''}`}
            aria-current={page === currentPage ? 'page' : undefined}
          >
            {page}
          </a>
        )
      ))}
    </div>

    {currentPage < totalPages ? (
      <a href={getPageUrl(currentPage + 1)} class="pagination-btn pagination-next" aria-label="Next page">
        <span>Next</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
    ) : (
      <span class="pagination-btn pagination-next disabled" aria-disabled="true">
        <span>Next</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </span>
    )}
  </nav>
)}

<style>
  .pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-border);
  }

  .pagination-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text);
    text-decoration: none;
    border: 1px solid var(--color-border);
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  .pagination-btn:hover:not(.disabled) {
    border-color: var(--color-accent);
    color: var(--color-accent);
  }

  .pagination-btn.disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .pagination-numbers {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .pagination-number {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 2.25rem;
    height: 2.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text);
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  .pagination-number:hover:not(.active) {
    background: var(--color-bg-secondary);
  }

  .pagination-number.active {
    background: var(--color-accent);
    color: var(--color-bg);
  }

  .pagination-ellipsis {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 2.25rem;
    height: 2.25rem;
    color: var(--color-text-secondary);
  }

  @media (max-width: 640px) {
    .pagination {
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .pagination-btn span {
      display: none;
    }

    .pagination-btn {
      padding: 0.5rem 0.75rem;
    }

    .pagination-numbers {
      order: -1;
      width: 100%;
      justify-content: center;
    }
  }
</style>

---
/**
 * Testimonials Component
 * 
 * Displays a section of featured testimonials/endorsements from colleagues and clients.
 * Automatically queries the testimonials content collection and filters for featured items.
 * Supports LinkedIn profile links with icon integration.
 * 
 * Testimonials are sorted by date (newest first) and can be limited to a specific count.
 * Only renders if there are featured testimonials available.
 * 
 * @component
 * 
 * @example
 * ```astro
 * <!-- Show all featured testimonials with default title -->
 * <Testimonials />
 * 
 * <!-- Limit to 2 testimonials -->
 * <Testimonials limit={2} />
 * 
 * <!-- Hide section title -->
 * <Testimonials showTitle={false} />
 * 
 * <!-- Custom title -->
 * <Testimonials title="Client Feedback" limit={5} />
 * ```
 */

import { getCollection } from 'astro:content';

interface Props {
  /** Maximum number of testimonials to display (default: 3) */
  limit?: number;
  
  /** Whether to show the section title (default: true) */
  showTitle?: boolean;
  
  /** Custom section title (default: "What People Say") */
  title?: string;
}

const { limit = 3, showTitle = true, title = "What People Say" } = Astro.props;

/**
 * Queries and filters featured testimonials from the content collection
 * 
 * Filters for testimonials marked as featured, sorts by date (newest first),
 * and limits to the specified count.
 * 
 * @returns Array of featured testimonial entries, sorted and limited
 */
const allTestimonials = await getCollection('testimonials');
const featuredTestimonials = allTestimonials
  .filter(testimonial => testimonial.data.featured === true)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, limit);
---

{featuredTestimonials.length > 0 && (
  <section class="testimonials">
    {showTitle && <h2 class="testimonials-title">{title}</h2>}
    <div class="testimonials-list">
      {featuredTestimonials.map((testimonial) => (
        <blockquote class="testimonial">
          <p class="testimonial-quote">"{testimonial.data.quote}"</p>
          <footer class="testimonial-attribution">
            <cite class="testimonial-author">
              {testimonial.data.linkedin ? (
                <a href={testimonial.data.linkedin} target="_blank" rel="noopener noreferrer" class="author-link">
                  <svg class="linkedin-icon" width="14" height="14" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,0 64,0 L8,0 C3.581722,0 0,3.581722 0,8 L0,64 C0,68.418278 3.581722,72 8,72 Z" fill="currentColor"/>
                    <path d="M62,62 L51.315625,62 L51.315625,43.8021149 C51.315625,38.8127542 49.4197917,36.0245323 45.4707031,36.0245323 C41.1746094,36.0245323 38.9300781,38.9261103 38.9300781,43.8021149 L38.9300781,62 L28.6333333,62 L28.6333333,27.3333333 L38.9300781,27.3333333 L38.9300781,32.0029283 C38.9300781,32.0029283 42.0260417,26.2742151 49.3825521,26.2742151 C56.7356771,26.2742151 62,30.7644705 62,40.051212 L62,62 Z M16.349349,22.7940133 C12.8420573,22.7940133 10,19.9296567 10,16.3970067 C10,12.8643566 12.8420573,10 16.349349,10 C19.8566406,10 22.6970052,12.8643566 22.6970052,16.3970067 C22.6970052,19.9296567 19.8566406,22.7940133 16.349349,22.7940133 Z M11.0325521,62 L21.769401,62 L21.769401,27.3333333 L11.0325521,27.3333333 L11.0325521,62 Z" fill="var(--color-bg)"/>
                  </svg>
                  {testimonial.data.name}
                </a>
              ) : (
                testimonial.data.name
              )}
              <span class="author-role">, {testimonial.data.role} at {testimonial.data.company}</span>
            </cite>
            <span class="testimonial-relationship">{testimonial.data.relationship}</span>
          </footer>
        </blockquote>
      ))}
    </div>
  </section>
)}

<style>
  .testimonials {
    margin-bottom: 5rem;
  }

  .testimonials-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 2rem;
    letter-spacing: -0.01em;
  }

  .testimonials-list {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
    max-width: 700px;
  }

  .testimonial {
    margin: 0;
    padding: 0;
    border: none;
  }

  .testimonial-quote {
    font-size: 1.125rem;
    line-height: 1.7;
    color: var(--color-text);
    font-style: italic;
    margin-bottom: 1rem;
  }

  .testimonial-attribution {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .testimonial-author {
    font-size: 0.9375rem;
    font-style: normal;
    color: var(--color-text-secondary);
    font-weight: 500;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
  }

  .author-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .author-link:hover {
    color: var(--color-accent);
  }

  .linkedin-icon {
    flex-shrink: 0;
    opacity: 0.7;
    transition: opacity 0.2s ease;
  }

  .author-link:hover .linkedin-icon {
    opacity: 1;
  }

  .author-role {
    color: var(--color-text-secondary);
  }

  .testimonial-relationship {
    font-size: 0.875rem;
    color: var(--color-text-muted);
  }

  @media (max-width: 768px) {
    .testimonial-quote {
      font-size: 1rem;
    }

    .testimonial-author {
      font-size: 0.875rem;
    }
  }
</style>

---
/**
 * Testimonials Component
 * 
 * Displays a section of featured testimonials/endorsements from colleagues and clients.
 * Automatically queries the testimonials content collection and filters for featured items.
 * 
 * Testimonials are sorted by date (newest first) and can be limited to a specific count.
 * Only renders if there are featured testimonials available.
 * 
 * @component
 * 
 * @example
 * ```astro
 * <!-- Show all featured testimonials with default title -->
 * <Testimonials />
 * 
 * <!-- Limit to 2 testimonials -->
 * <Testimonials limit={2} />
 * 
 * <!-- Hide section title -->
 * <Testimonials showTitle={false} />
 * 
 * <!-- Custom title -->
 * <Testimonials title="Client Feedback" limit={5} />
 * ```
 */

import { getCollection } from 'astro:content';

interface Props {
  /** Maximum number of testimonials to display (default: 3) */
  limit?: number;
  
  /** Whether to show the section title (default: true) */
  showTitle?: boolean;
  
  /** Custom section title (default: "What People Say") */
  title?: string;
}

const { limit = 3, showTitle = true, title = "What People Say" } = Astro.props;

/**
 * Queries and filters featured testimonials from the content collection
 * 
 * Filters for testimonials marked as featured, sorts by date (newest first),
 * and limits to the specified count.
 * 
 * @returns Array of featured testimonial entries, sorted and limited
 */
const allTestimonials = await getCollection('testimonials');
const featuredTestimonials = allTestimonials
  .filter(testimonial => testimonial.data.featured === true)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, limit);
---

{featuredTestimonials.length > 0 && (
  <section class="testimonials">
    {showTitle && <h2 class="testimonials-title">{title}</h2>}
    <div class="testimonials-list">
      {featuredTestimonials.map((testimonial) => (
        <blockquote class="testimonial">
          <p class="testimonial-quote">"{testimonial.data.quote}"</p>
          <footer class="testimonial-attribution">
            <cite class="testimonial-author">
              {testimonial.data.name}
              <span class="author-role">, {testimonial.data.role} at {testimonial.data.company}</span>
            </cite>
            <span class="testimonial-relationship">{testimonial.data.relationship}</span>
          </footer>
        </blockquote>
      ))}
    </div>
  </section>
)}

<style>
  .testimonials {
    margin-bottom: 5rem;
  }

  .testimonials-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 2rem;
    letter-spacing: -0.01em;
  }

  .testimonials-list {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
    max-width: 700px;
  }

  .testimonial {
    margin: 0;
    padding: 0;
    border: none;
  }

  .testimonial-quote {
    font-size: 1.125rem;
    line-height: 1.7;
    color: var(--color-text);
    font-style: italic;
    margin-bottom: 1rem;
  }

  .testimonial-attribution {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .testimonial-author {
    font-size: 0.9375rem;
    font-style: normal;
    color: var(--color-text-secondary);
    font-weight: 500;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
  }

  .author-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .author-link:hover {
    color: var(--color-accent);
  }

  .author-role {
    color: var(--color-text-secondary);
  }

  .testimonial-relationship {
    font-size: 0.875rem;
    color: var(--color-text-muted);
  }

  @media (max-width: 768px) {
    .testimonial-quote {
      font-size: 1rem;
    }

    .testimonial-author {
      font-size: 0.875rem;
    }
  }
</style>
